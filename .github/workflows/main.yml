name: "CI"
on:
  push:
    branches: [ main ]
jobs:
  generate_pdf:
    name: Generate Resume PDF
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout
      uses: actions/checkout@v3.3.0
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    - name: Install Playwright
      run: |
        npm install playwright http-server
        npx playwright install chromium
    - name: Generate PDF
      run: |
        # Start a simple HTTP server in the background
        npx http-server . -p 8080 --silent &
        HTTP_SERVER_PID=$!
        sleep 2
        
        # Generate PDF from the served content
        node -e "
        const { chromium } = require('playwright');
        (async () => {
          const browser = await chromium.launch();
          const page = await browser.newPage();
          await page.emulateMedia({ media: 'screen' });
          await page.goto('http://localhost:8080', { waitUntil: 'networkidle' });
          await page.waitForTimeout(3000);
          await page.pdf({ 
            path: 'resume.pdf', 
            format: 'Letter',
            scale: 0.75,
            margin: { top: '0.5in', right: '0.5in', bottom: '0.5in', left: '0.5in' },
            printBackground: true
          });
          await browser.close();
        })();
        "
        
        # Kill the HTTP server
        kill $HTTP_SERVER_PID
    - name: Get Current Date
      id: date
      run: echo "::set-output name=date::$(date -u +'%Y-%m-%d_%H-%M-%S')"
    - name: GH Release
      uses: softprops/action-gh-release@v0.1.15
      with:
        tag_name: releases/${{ steps.date.outputs.date }}
        files: ./resume.pdf

